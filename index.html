<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <title>Our Memory - AR Experience (Final Position)</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { margin: 0; padding: 0; font-family: 'Vazirmatn', sans-serif; background-color: #000; color: #fff; overflow: hidden; direction: ltr; }
        #loading-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; background-color: rgba(0, 0, 0, 0.9); z-index: 1000; font-size: 1.2rem; text-align: center; animation: fadeOut 2s forwards; animation-delay: 5s; }
        #loading-screen p { background-color: rgba(255, 255, 255, 0.2); padding: 10px 20px; border-radius: 10px; backdrop-filter: blur(5px); }
        @keyframes fadeOut { to { opacity: 0; visibility: hidden; } }
        
        .instruction-box { 
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); 
            background-color: rgba(0, 0, 0, 0.7); padding: 15px; border-radius: 15px; 
            color: #fff; text-align: center; font-size: 1rem; z-index: 999; 
            backdrop-filter: blur(5px);
            opacity: 1;
            transition: opacity 2s ease-out;
        }
        .instruction-box.hide {
            opacity: 0;
            pointer-events: none;
        }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.0.3/Vazirmatn-Variable-font-face.css">
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.0/dist/mindar-image-aframe.prod.js"></script>

    <script>
        AFRAME.registerComponent('custom-layout', {
            init: function() {
                const targetEntity = this.el;

                // A constant value has been added to the 'y' position of all items to move them up.
                const mediaItems = [
                    // Item 1
                    { 
                        type: 'image', src: "https://placehold.co/600x600/FFFFFF/black?text=1", 
                        width: 0.6, height: 0.6, 
                        pos: { x: 0, y: 2.5925, z: 0 }, 
                        rot: { x: 0, y: 0, z: 0 } 
                    },
                    // Item 2
                    { 
                        type: 'image', src: "https://placehold.co/800x600/6A5ACD/white?text=2", 
                        width: 1.5, height: 1.125,
                        pos: { x: -0.88, y: 1.5406, z: 0 }, 
                        rot: { x: 0, y: 0, z: 0 } 
                    },
                    // Item 3 (Video)
                    { 
                        type: 'video', src: "https://archive.org/download/BigBuckBunny_124/Content/big_buck_bunny_720p_stereo.mp4", 
                        width: 1.5, height: 1.125,
                        pos: { x: 0.88, y: 1.5406, z: 0 }, 
                        rot: { x: 0, y: 0, z: 0 } 
                    },
                    // Item 4
                    { 
                        type: 'image', src: "https://placehold.co/600x800/4682B4/white?text=4", 
                        width: 1.125, height: 1.5,
                        pos: { x: -1.32, y: 0.0625, z: 0 }, 
                        rot: { x: 0, y: 0, z: 0 } 
                    },
                    // Item 5
                    { 
                        type: 'image', src: "https://placehold.co/600x800/2E8B57/white?text=5", 
                        width: 1.125, height: 1.5,
                        pos: { x: 1.32, y: 0.0625, z: 0 }, 
                        rot: { x: 0, y: 0, z: 0 } 
                    },
                ];

                mediaItems.forEach((item, index) => {
                    const container = createFramedMedia(item, index);
                    targetEntity.appendChild(container);
                });

                function createFramedMedia(item, index) {
                    const container = document.createElement('a-entity');
                    container.setAttribute('position', `${item.pos.x} ${item.pos.y} ${item.pos.z}`);
                    container.setAttribute('rotation', `${item.rot.x} ${item.rot.y} ${item.rot.z}`);

                    const frameWidth = item.width * 1.1;
                    const frameHeight = item.height * 1.1;
                    const animationDelay = 300 + index * 200;

                    const shadow = document.createElement('a-plane');
                    shadow.setAttribute('width', frameWidth);
                    shadow.setAttribute('height', frameHeight);
                    shadow.setAttribute('position', '0 0 -0.02');
                    shadow.setAttribute('material', 'color: #000; transparent: true; opacity: 0.5;');

                    const frame = document.createElement('a-plane');
                    frame.setAttribute('width', frameWidth);
                    frame.setAttribute('height', frameHeight);
                    frame.setAttribute('position', '0 0 -0.01');
                    frame.setAttribute('material', 'color: white;');
                    
                    let mediaElement;
                    if (item.type === 'image') {
                        mediaElement = document.createElement('a-image');
                        mediaElement.setAttribute('src', item.src);
                    } else if (item.type === 'video') {
                        mediaElement = document.createElement('a-video');
                        mediaElement.setAttribute('src', item.src);
                        mediaElement.setAttribute('loop', 'true');
                        mediaElement.setAttribute('autoplay', 'true');
                        mediaElement.setAttribute('muted', 'true');

                        targetEntity.addEventListener('targetFound', () => { mediaElement.play(); });
                        targetEntity.addEventListener('targetLost', () => { mediaElement.pause(); });
                    }
                    mediaElement.setAttribute('width', item.width);
                    mediaElement.setAttribute('height', item.height);
                    mediaElement.setAttribute('position', '0 0 0');

                    container.setAttribute('animation__scale', `property: scale; from: 0 0 0; to: 1 1 1; dur: 1000; easing: easeOutBack; delay: ${animationDelay}`);
                    
                    container.appendChild(shadow);
                    container.appendChild(frame);
                    container.appendChild(mediaElement);
                    
                    return container;
                }
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            const instructionBox = document.querySelector('.instruction-box');
            setTimeout(() => {
                if (instructionBox) {
                    instructionBox.classList.add('hide');
                }
            }, 6000); 
        });
    </script>
</head>
<body>

    <div id="loading-screen">
        <p>Preparing Augmented Reality experience...</p>
        <p>Please allow camera access.</p>
    </div>

    <div class="instruction-box">
        Point your camera at the anniversary photo frame.<br>
        Wait for new photos and videos to appear!
    </div>

    <a-scene mindar-image="imageTargetSrc: targets.mind;"
             color-space="sRGB"
             renderer="colorManagement: true, physicallyCorrectLights: true"
             vr-mode-ui="enabled: false"
             device-orientation-permission-ui="enabled: false">
        
        <a-camera mindar-image-camera=""></a-camera>

        <a-entity mindar-image-target="targetIndex: 0" custom-layout>
        </a-entity>

    </a-scene>
</body>
</html>
