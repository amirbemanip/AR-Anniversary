<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <title>یادگاری ما - واقعیت افزوده</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Vazirmatn', sans-serif;
            background-color: #000;
            color: #fff;
            overflow: hidden;
            direction: rtl;
        }
        #loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            font-size: 1.2rem;
            text-align: center;
            animation: fadeOut 2s forwards;
            animation-delay: 5s;
        }

        #loading-screen p {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 10px;
            backdrop-filter: blur(5px);
        }
        @keyframes fadeOut {
            to { opacity: 0; visibility: hidden; }
        }
        .instruction-box {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 15px;
            color: #fff;
            text-align: center;
            font-size: 1rem;
            z-index: 999;
            backdrop-filter: blur(5px);
        }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.0.3/Vazirmatn-Variable-font-face.css">
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.0/dist/mindar-image-aframe.prod.js"></script>
</head>
<body>

    <div id="loading-screen">
        <p>در حال آماده‌سازی تجربه واقعیت افزوده...</p>
        <p>لطفاً مجوز دسترسی به دوربین را تایید کنید.</p>
    </div>

    <div class="instruction-box">
        دوربین را به سمت قاب عکس سالگرد بگیرید.<br>
        منتظر بمانید تا عکس‌ها و ویدئوهای جدید ظاهر شوند!
    </div>

    <a-scene mindar-image="imageTargetSrc: targets.mind;"
             color-space="sRGB"
             renderer="colorManagement: true, physicallyCorrectLights: true"
             vr-mode-ui="enabled: false"
             device-orientation-permission-ui="enabled: false">

        <a-camera mindar-image-camera=""></a-camera>

        <a-entity mindar-image-target="targetIndex: 0">
            <script>
                const targetEntity = document.querySelector('a-entity[mindar-image-target]');

                // اطلاعات عکس‌ها و ویدئوها
                // مختصات به صورت زیر تنظیم شده تا دقیقاً مطابق با طرح شما باشد.
                const mediaItems = [
                    {
                        type: 'image',
                        src: "https://placehold.co/600x600/C0C0C0/white?text=Image+1", // مربع شده
                        width: '0.8', // بزرگتر شده
                        height: '0.8', // بزرگتر شده
                        pos: { x: 0.0, y: 1.5, z: 0.05, rot: 0 } // بالاتر قرار گرفته
                    },
                    {
                        type: 'image',
                        src: "https://placehold.co/1200x600/A9A9A9/white?text=Image+2", // دو برابر شده
                        width: '1.2',
                        height: '0.6',
                        pos: { x: -0.7, y: 0.8, z: 0.05, rot: 10 } // بالاتر و نزدیک به مرکز
                    },
                    {
                        type: 'video',
                        src: "https://archive.org/download/BigBuckBunny_124/Content/big_buck_bunny_720p_stereo.mp4",
                        width: '1.2',
                        height: '0.6',
                        pos: { x: 0.7, y: 0.8, z: 0.05, rot: -10 } // بالاتر و نزدیک به مرکز
                    },
                    {
                        type: 'image',
                        src: "https://placehold.co/600x1200/708090/white?text=Image+4", // عمودی شده
                        width: '0.6',
                        height: '1.2',
                        pos: { x: -1.2, y: -0.1, z: 0.05, rot: 15 } // عمودی شده
                    },
                    {
                        type: 'video',
                        src: "https://archive.org/download/BigBuckBunny_124/Content/big_buck_bunny_720p_stereo.mp4",
                        width: '0.6',
                        height: '1.2',
                        pos: { x: 1.2, y: -0.1, z: 0.05, rot: -15 } // عمودی شده
                    }
                ];

                function createMediaWithFrame(item, delay) {
                    // Create a container for the frame and the media
                    const container = document.createElement('a-entity');
                    container.setAttribute('position', `${item.pos.x} ${item.pos.y} ${item.pos.z}`);
                    container.setAttribute('rotation', `0 0 ${item.pos.rot}`);

                    // Create the frame
                    const frame = document.createElement('a-plane');
                    frame.setAttribute('width', item.width * 1.15); // کمی بزرگتر از محتوا
                    frame.setAttribute('height', item.height * 1.15); // کمی بزرگتر از محتوا
                    frame.setAttribute('position', `0 0 0.01`);
                    frame.setAttribute('material', 'color: #333; transparent: true; opacity: 0.9');

                    // Create the media element (image or video)
                    let mediaElement;
                    if (item.type === 'image') {
                        mediaElement = document.createElement('a-image');
                        mediaElement.setAttribute('width', item.width);
                        mediaElement.setAttribute('height', item.height);
                        mediaElement.setAttribute('src', item.src);
                    } else if (item.type === 'video') {
                        mediaElement = document.createElement('a-video');
                        mediaElement.setAttribute('width', item.width);
                        mediaElement.setAttribute('height', item.height);
                        mediaElement.setAttribute('src', item.src);
                        mediaElement.setAttribute('loop', 'true');
                        mediaElement.setAttribute('autoplay', 'true');
                        mediaElement.setAttribute('muted', 'true'); // Required for mobile autoplay
                    }

                    mediaElement.setAttribute('position', `0 0 0.02`);
                    mediaElement.setAttribute('material', 'shader: standard; metalness: 0.1; roughness: 0.8; transparent: true; opacity: 0;');
                    
                    // Add animations
                    container.setAttribute('animation__scale', `property: scale; from: 0.1 0.1 0.1; to: 1 1 1; dur: 1000; easing: easeOutElastic; delay: ${delay}`);
                    mediaElement.setAttribute('animation__fade', `property: material.opacity; from: 0; to: 1; dur: 2000; easing: easeInSine; delay: ${delay}`);

                    container.appendChild(frame);
                    container.appendChild(mediaElement);

                    targetEntity.appendChild(container);

                    // If it's a video, handle playback once the marker is found
                    if (item.type === 'video') {
                        targetEntity.addEventListener('targetFound', () => {
                            mediaElement.play();
                        });
                        targetEntity.addEventListener('targetLost', () => {
                            mediaElement.pause();
                        });
                    }
                }

                mediaItems.forEach((item, index) => {
                    const delay = index * 500;
                    createMediaWithFrame(item, delay);
                });
            </script>
        </a-entity>

    </a-scene>

</body>
</html>
